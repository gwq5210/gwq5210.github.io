<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    

    

    



    <meta charset="utf-8">
    
    
    
    <title>c语言中使用数据库 | gwq5210&#39;s Blog | 凡是过往，皆为序章！</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="c语言,数据库,mysql">
    <meta name="description" content="安装首先，要安装mysql数据库，安装好后，可能还不能使用mysql的c语言库，还要安装mysql的库，命令如下：sudo apt-get install libmysql++-dev。安装好后，就可以包含头文件，然后使用mysql的c语言api了。 数据结构1）MYSQL这个结构体代表一个数据库连接的句柄，它被大多数的mysql函数使用。不要尝试拷贝MYSQL结构体，不保证这样的拷贝是可以使用的">
<meta name="keywords" content="c语言,数据库,mysql">
<meta property="og:type" content="article">
<meta property="og:title" content="c语言中使用数据库">
<meta property="og:url" content="https://gwq5210.com/2016/01/23/c语言中使用数据库/index.html">
<meta property="og:site_name" content="gwq5210&#39;s Blog">
<meta property="og:description" content="安装首先，要安装mysql数据库，安装好后，可能还不能使用mysql的c语言库，还要安装mysql的库，命令如下：sudo apt-get install libmysql++-dev。安装好后，就可以包含头文件，然后使用mysql的c语言api了。 数据结构1）MYSQL这个结构体代表一个数据库连接的句柄，它被大多数的mysql函数使用。不要尝试拷贝MYSQL结构体，不保证这样的拷贝是可以使用的">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2021-10-22T06:46:41.732Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="c语言中使用数据库">
<meta name="twitter:description" content="安装首先，要安装mysql数据库，安装好后，可能还不能使用mysql的c语言库，还要安装mysql的库，命令如下：sudo apt-get install libmysql++-dev。安装好后，就可以包含头文件，然后使用mysql的c语言api了。 数据结构1）MYSQL这个结构体代表一个数据库连接的句柄，它被大多数的mysql函数使用。不要尝试拷贝MYSQL结构体，不保证这样的拷贝是可以使用的">
    
        <link rel="alternate" type="application/atom+xml" title="gwq5210&#39;s Blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu"  >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/images/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/images/logo.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">gwq5210</h5>
          <a href="mailto:gwq5210@qq.com" title="gwq5210@qq.com" class="mail">gwq5210@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                文章
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/gwq5210" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about"  >
                <i class="icon icon-lg icon-link"></i>
                关于
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">c语言中使用数据库</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">c语言中使用数据库</h1>
        <h5 class="subtitle">
            
                <time datetime="2016-01-23T20:21:40.000Z" itemprop="datePublished" class="page-time">
  2016-01-23
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/编程/">编程</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/编程/mysql/">mysql</a></li></ul></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#安装"><span class="post-toc-number">1.</span> <span class="post-toc-text">安装</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#数据结构"><span class="post-toc-number">2.</span> <span class="post-toc-text">数据结构</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#常用函数"><span class="post-toc-number">3.</span> <span class="post-toc-text">常用函数</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#参考"><span class="post-toc-number">4.</span> <span class="post-toc-text">参考</span></a></li></ol>
        </nav>
    </aside>
    
<article id="post-c语言中使用数据库"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">c语言中使用数据库</h1>
        <div class="post-meta">
            <time class="post-time" title="2016-01-23 20:21:40" datetime="2016-01-23T20:21:40.000Z"  itemprop="datePublished">2016-01-23</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/编程/">编程</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/编程/mysql/">mysql</a></li></ul></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>首先，要安装mysql数据库，安装好后，可能还不能使用mysql的c语言库，还要安装mysql的库，命令如下：sudo apt-get install libmysql++-dev。<br>安装好后，就可以包含<mysql mysql.h>头文件，然后使用mysql的c语言api了。</mysql></p>
<h2 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h2><p>1）MYSQL<br>这个结构体代表一个数据库连接的句柄，它被大多数的mysql函数使用。不要尝试拷贝MYSQL结构体，不保证这样的拷贝是可以使用的。<br>MYSQL的定义如下：</p>
<a id="more"></a>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">st_mysql</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  NET       net;            <span class="comment">/* Communication parameters */</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> *connector_fd;      <span class="comment">/* ConnectorFd for SSL */</span></span><br><span class="line">  <span class="keyword">char</span>      *host,*user,*passwd,*unix_socket,*server_version,*host_info;</span><br><span class="line">  <span class="keyword">char</span>          *info, *db;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">charset_info_st</span> *<span class="title">charset</span>;</span></span><br><span class="line">  MYSQL_FIELD   *fields;</span><br><span class="line">  MEM_ROOT  field_alloc;</span><br><span class="line">  my_ulonglong affected_rows;</span><br><span class="line">  my_ulonglong insert_id;       <span class="comment">/* id if insert on table with NEXTNR */</span></span><br><span class="line">  my_ulonglong extra_info;      <span class="comment">/* Not used */</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">long</span> thread_id;      <span class="comment">/* Id for connection in server */</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">long</span> packet_length;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span>  port;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">long</span> client_flag,server_capabilities;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span>  protocol_version;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span>  field_count;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span>  server_status;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span>  server_language;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span>  warning_count;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">st_mysql_options</span> <span class="title">options</span>;</span></span><br><span class="line">  <span class="keyword">enum</span> mysql_status status;</span><br><span class="line">  my_bool   free_me;        <span class="comment">/* If free in mysql_close */</span></span><br><span class="line">  my_bool   reconnect;      <span class="comment">/* set to 1 if automatic reconnect */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* session-wide random string */</span></span><br><span class="line">  <span class="keyword">char</span>          scramble[SCRAMBLE_LENGTH+<span class="number">1</span>];</span><br><span class="line">  my_bool unused1;</span><br><span class="line">  <span class="keyword">void</span> *unused2, *unused3, *unused4, *unused5;</span><br><span class="line"></span><br><span class="line">  LIST  *stmts;                     <span class="comment">/* list of all statements */</span></span><br><span class="line">  <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">st_mysql_methods</span> *<span class="title">methods</span>;</span></span><br><span class="line">  <span class="keyword">void</span> *thd;</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    Points to boolean flag in MYSQL_RES  or MYSQL_STMT. We set this flag </span></span><br><span class="line"><span class="comment">    from mysql_stmt_close if close had to cancel result set of this object.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  my_bool *unbuffered_fetch_owner;</span><br><span class="line">  <span class="comment">/* needed for embedded server - no net buffer to store the 'info' */</span></span><br><span class="line">  <span class="keyword">char</span> *info_buffer;</span><br><span class="line">  <span class="keyword">void</span> *extension;</span><br><span class="line">&#125; MYSQL;</span><br></pre></td></tr></table></figure>
<p>2）MYSQL_RES<br>这个结构体代表查询结果的所有列（SELECT，SHOW，DESCRIBE，EXPLAIN）。查询返回的结果叫做数据集，可以在后边使用。<br>MYSQL_RES的定义如下：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">st_mysql_res</span> &#123;</span></span><br><span class="line">  my_ulonglong  row_count;</span><br><span class="line">  MYSQL_FIELD   *fields;</span><br><span class="line">  MYSQL_DATA    *data;</span><br><span class="line">  MYSQL_ROWS    *data_cursor;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">long</span> *lengths;       <span class="comment">/* column lengths of current row */</span></span><br><span class="line">  MYSQL     *handle;        <span class="comment">/* for unbuffered reads */</span></span><br><span class="line">  <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">st_mysql_methods</span> *<span class="title">methods</span>;</span></span><br><span class="line">  MYSQL_ROW row;            <span class="comment">/* If unbuffered read */</span></span><br><span class="line">  MYSQL_ROW current_row;        <span class="comment">/* buffer to current row */</span></span><br><span class="line">  MEM_ROOT  field_alloc;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span>  field_count, current_field;</span><br><span class="line">  my_bool   eof;            <span class="comment">/* Used by mysql_fetch_row */</span></span><br><span class="line">  <span class="comment">/* mysql_stmt_close() had to cancel this result */</span></span><br><span class="line">  my_bool       unbuffered_fetch_cancelled;  </span><br><span class="line">  <span class="keyword">void</span> *extension;</span><br><span class="line">&#125; MYSQL_RES;</span><br></pre></td></tr></table></figure></p>
<p>3，MYSQL_ROW<br>用来表示查询出来的一行，可以通过mysql_fetch_row()函数获得。<br>MYSQL_ROW的定义如下：<br><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typedef char **MYSQ<span class="class">L_ROW;</span>       /*<span class="built_in"> return </span>data as<span class="built_in"> array </span>of strings */</span><br></pre></td></tr></table></figure></p>
<p>4，MYSQL_FIELD<br>用来表示数据库中的字段。包含的信息有字段名，类型，大小等。可以通过mysql_fetch_field()函数获得。<br>MYSQL_FIELD的定义如下：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">st_mysql_field</span> &#123;</span></span><br><span class="line">  <span class="keyword">char</span> *name;                 <span class="comment">/* Name of column */</span></span><br><span class="line">  <span class="keyword">char</span> *org_name;             <span class="comment">/* Original column name, if an alias */</span></span><br><span class="line">  <span class="keyword">char</span> *table;                <span class="comment">/* Table of column if column was a field */</span></span><br><span class="line">  <span class="keyword">char</span> *org_table;            <span class="comment">/* Org table name, if table was an alias */</span></span><br><span class="line">  <span class="keyword">char</span> *db;                   <span class="comment">/* Database for table */</span></span><br><span class="line">  <span class="keyword">char</span> *catalog;          <span class="comment">/* Catalog for table */</span></span><br><span class="line">  <span class="keyword">char</span> *def;                  <span class="comment">/* Default value (set by mysql_list_fields) */</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">long</span> length;       <span class="comment">/* Width of column (create length) */</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">long</span> max_length;   <span class="comment">/* Max width for selected set */</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> name_length;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> org_name_length;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> table_length;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> org_table_length;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> db_length;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> catalog_length;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> def_length;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> flags;         <span class="comment">/* Div flags */</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> decimals;      <span class="comment">/* Number of decimals in field */</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> charsetnr;     <span class="comment">/* Character set */</span></span><br><span class="line">  <span class="keyword">enum</span> enum_field_types type; <span class="comment">/* Type of field. See mysql_com.h for types */</span></span><br><span class="line">  <span class="keyword">void</span> *extension;</span><br><span class="line">&#125; MYSQL_FIELD;</span><br></pre></td></tr></table></figure></p>
<h2 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数"></a>常用函数</h2><p>1）mysql_init<br>头文件：<br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mysql/mysql.h&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<p>函数原型为：<br><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MYSQL *mysql_init(MYSQL *mysql)<span class="comment">;</span></span><br></pre></td></tr></table></figure></p>
<p>在连接数据库之前，必须调用mysql_init函数来初始化一个MYSQL结构体。这个结构体可以使用mysql_real_connect()函数连接数据库。如果mysql是NULL，那么函数初始化一个新的结构体，分配新的内存空间，并返回内存空间的地址，如果不是NULL，则初始化mysql指向的内存，返回传进来的地址。函数执行成功返回MYSQL结构体的指针，否则返回NULL。</p>
<p>2）mysql_real_connect<br>连接数据库需要设置相关的参数，可以使用这个函数来完成，并进行实际的连接。原型如下：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">MYSQL *<span class="title">mysql_real_connect</span><span class="params">(MYSQL *mysql, <span class="keyword">const</span> <span class="keyword">char</span> *host,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">const</span> <span class="keyword">char</span> *user,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">const</span> <span class="keyword">char</span> *passwd,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">const</span> <span class="keyword">char</span> *db,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">unsigned</span> <span class="keyword">int</span> port,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">const</span> <span class="keyword">char</span> *unix_socket,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">unsigned</span> <span class="keyword">long</span> clientflag)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>需要包含头文件：<br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mysql/mysql.h&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<p>来说明参数的含义:</p>
<ul>
<li>mysql是使用mysql_init()函数初始化的结构体；</li>
<li>host是mysql服务器所在的服务器计算机名或者ip地址，如果host是NULL或者是字符串”localhost”，那么就连接到本地计算机；</li>
<li>user和passwd是数据库登陆时的用户名和密码，如果user是NULL或者空字符串””，那么假设用户名为当前登陆的用户ID，如果passwd是NULL，则只可以访问这个服务器中不需要口令的数据，口令在传递到网络以前是加密的；</li>
<li>db表示数据库的名字，如果db不是NULL，那么连接将这个数据库设置为默认的数据库；</li>
<li>如果port非零，那么这个值用来当做TCP/IP连接的端口，一般来说port取0；</li>
<li>如果unix_socket不是NULL，那么这个字符串指定的socket或者命名管道会使用，这与host参数有关；一般来unix_socket取NULL；</li>
<li>clientflag通常为0，在很特殊的情况下可以是一些标志的组合，下面列出一些，详细请见文档。<ol>
<li>CLIENT_FOUND_ROWS，返回找到的（匹配的）行数，而不是收到影响的行数。</li>
<li>CLIENT_NO_SCHEMA，不允许db_name.tbl_name.col_name语法，这是为了ODBC，如果使用该语法，将导致语法分析器产生一个错误，它在一些有bugs的ODBC程序中是有用的。</li>
<li>CLIENT_COMPRESS，使用压缩协议。</li>
</ol>
</li>
</ul>
<p>mysql_real_connect函数成功返回一个只想MYSQL结构体的指针，返回值与第一个参数值相同，如果连接失败返回NULL，可以使用mysql_error()函数来查看错误原因。</p>
<p>3）mysql_close<br>完成连接任务后，可以用mysql_close()来关闭连接，原型如下：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mysql/mysql.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mysql_close</span><span class="params">(MYSQL *sock)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>关闭连接后，sock会被清空，指针也变的无效而不能再使用。</p>
<p>4）mysql_options<br>这个函数与连接函数关系紧密，它只能在mysql_init()函数和mysql_real_connect函数之间调用。原型如下：<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;mysql/mysql.h&gt;</span></span><br><span class="line"></span><br><span class="line">int mysql_options(MYSQL *mysql,<span class="class"><span class="keyword">enum</span> <span class="title">mysql_option</span> <span class="title">option</span>,  </span></span><br><span class="line">         const void *arg);</span><br></pre></td></tr></table></figure></p>
<p>这个函数用来设置额外的连接选项，并影响连接的行为。可以多次调用该函数来设置数个选项。option是打算设置的选项，arg是打算设置的值。如果选项是整数，那么arg应该指向整数的值，下面列出一些选项，详细请见文档。</p>
<ul>
<li>MYSQL_INIT_COMMAND，参数类型为char *，当连接到mysql服务器时执行的命令，再次执行连接时会自动的调用。</li>
<li>MYSQL_OPT_CONNECT_TIMEOUT，参数类型为unsigned int *，以秒为单位的连接超时。</li>
<li>MYSQL_OPT_PROTOCOL，参数类型为unsigned int *，要使用的协议类型，应该是mysql.h中定义的mysql_protocal_type的枚举类型之一。</li>
<li>MYSQL_OPT_COMPRESS，参数没有使用，在网络连接中使用压缩。</li>
</ul>
<p>mysql_options()函数成功调用返回0，否则返回非零值。</p>
<p>5）mysql_errno<br>函数原型为：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mysql/mysql.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">mysql_errno</span><span class="params">(MYSQL *mysql)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>这个函数用来获取制定的连接最近调用函数的错误代码。这个函数调用可能成功，也可能失败。返回0表示未出现错误。在MYSQL errmsg.h头文件中列出了错误信息的代码。</p>
<p>6）mysql_error<br>函数原型为：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mysql/mysql.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">const</span> <span class="keyword">char</span> *<span class="title">mysql_error</span><span class="params">(MYSQL *mysql)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>对于mysql指定的连接，mysql_error()函数返回最近调用函数失败原因的字符串表示，字符串以’\0’作为终结字符，如果没有错误，则返回的可能时上一个错误，或者返回空串。如果返回空串，说明没有产生错误。</p>
<p>7）mysql_query，mysql_real_query<br>函数原型如下：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mysql/mysql.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">mysql_query</span><span class="params">(MYSQL *mysql, <span class="keyword">const</span> <span class="keyword">char</span> *q)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">mysql_real_query</span><span class="params">(MYSQL *mysql, <span class="keyword">const</span> <span class="keyword">char</span> *q,</span></span></span><br><span class="line"><span class="function"><span class="params">                    <span class="keyword">unsigned</span> <span class="keyword">long</span> length)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>对于制定mysql连接，执行q指向的字符串的SQL语句，与命令行不同，它不需要包含表示终止的分号。如果运行成功，函数返回0，否则返回非零。mysql_query()函数不能用来执行包含二进制数据的语句操作，这时，就必须使用mysql_real_query()函数，length代表字符串的长度，此外，mysql_real_query不需要调用strlen来，所以更快。你可以使用mysql_field_count()函数来检查语句是否返回结果集。<br>错误信息可能是如下情况：</p>
<ul>
<li>CR_COMMANDS_OUT_OF_SYNC，以不恰当的顺序执行了命令。</li>
<li>CR_SERVER_GONE_ERROR，mysql服务器不可用。</li>
<li>CR_SERVER_LOST，查询过程中，与服务器的连接丢失了。</li>
<li>CR_UNKNOWN_ERROR，未知的错误。</li>
</ul>
<p>8）mysql_affected_rows<br>函数原型为：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mysql/mysql.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">my_ulonglong <span class="title">mysql_affected_rows</span><span class="params">(MYSQL *mysql)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>这个函数用在不返回数据的SQL语句中，也就是UPDATA，DELETE和INSERT语句。这个函数返回上次UPDATE更改的行数，上次DELETE删除的行数或者上次INSERT插入的行数，或SELECT返回的行数。可以在执行过mysql_query()函数或者mysql_real_query()函数后调用。对于SELECT语句这个函数类似mysql_num_rows()。<br>返回值大于零表示影响的行数。零表示对于UPDATE没有数据被更新，在执行中没有行匹配WHERE子句或者没有语句被执行。-1表示出错，或者对于SELECT语句，mysql_affected_rows()函数的调用先于mysql_store_result()。因为这个函数返回无符号的值，所以，可以使用如下的方式检查-1，(my_ulonglong)-1或(my_ulonglong)~0，这两个方式是等价的。</p>
<p>通常，从mysql数据库中检索数据有四个步骤。</p>
<ul>
<li>发出查询。</li>
<li>检索数据。</li>
<li>处理数据。</li>
<li>整理所需要的数据。</li>
</ul>
<p>用mysql_query或mysql_real_query发出查询。检索数据可以用mysql_store_result或mysql_use_result，取决于怎样检索数据，接着是调用mysql_fetch_row来处理数据，最后必须调用mysql_free_result来让mysql进行必要的整理工作。</p>
<p>9）mysql_store_result<br>函数原型为：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mysql/mysql.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">MYSQL_RES *<span class="title">mysql_store_result</span><span class="params">(MYSQL *mysql)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>这个函数必须在调用mysql_query或者mysql_real_query函数后才能使用，用来在结果集中存储数据。可以产生数据的语句有SELECT，SHOW，DESCRIBE，EXPLAIN，CHECK TABLE等等。在对结果集操作完成后，你必须调用mysql_free_result。<br>这个函数返回一个结果集的指针，如果失败，则返回NULL。MYSQL_RES结构体定义如下：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">st_mysql_res</span> &#123;</span></span><br><span class="line">  my_ulonglong  row_count;</span><br><span class="line">  MYSQL_FIELD   *fields;</span><br><span class="line">  MYSQL_DATA    *data;</span><br><span class="line">  MYSQL_ROWS    *data_cursor;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">long</span> *lengths;       <span class="comment">/* column lengths of current row */</span></span><br><span class="line">  MYSQL     *handle;        <span class="comment">/* for unbuffered reads */</span></span><br><span class="line">  <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">st_mysql_methods</span> *<span class="title">methods</span>;</span></span><br><span class="line">  MYSQL_ROW row;            <span class="comment">/* If unbuffered read */</span></span><br><span class="line">  MYSQL_ROW current_row;        <span class="comment">/* buffer to current row */</span></span><br><span class="line">  MEM_ROOT  field_alloc;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span>  field_count, current_field;</span><br><span class="line">  my_bool   eof;            <span class="comment">/* Used by mysql_fetch_row */</span></span><br><span class="line">  <span class="comment">/* mysql_stmt_close() had to cancel this result */</span></span><br><span class="line">  my_bool       unbuffered_fetch_cancelled;  </span><br><span class="line">  <span class="keyword">void</span> *extension;</span><br><span class="line">&#125; MYSQL_RES;</span><br></pre></td></tr></table></figure></p>
<p>10）mysql_num_rows<br>函数原型为：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mysql/mysql.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">my_ulonglong STDCALL <span class="title">mysql_num_rows</span><span class="params">(MYSQL_RES *res)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>如果调用mysql_store_result成功，则可以使用mysql_num_rows函数来检索实际返回的行数，返回结果当然可能为0。如果mysql_store_result成功，这个函数也会成功。<br>一旦调用mysql_store_result成功，那么所有查询的数据都将存储在客户端，不需要冒着网络出错的危险。如果查询的数据量很大，最好还是按照需要检索数据。<br>检索到数据后，需要对数据进行处理，可以使用这些函数：mysql_fetch_row,mysql_data_seek,mysql_row_tell,mysql_row_seek，将在下面介绍。</p>
<p>11）mysql_fetch_row<br>函数原型为：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mysql/mysql.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">MYSQL_ROW <span class="title">mysql_fetch_row</span><span class="params">(MYSQL_RES *result)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>这个函数返回结果集中的下一行数据。如果没有更多数据或出错，则返回NULL。</p>
<p>12）mysql_data_seek<br>函数原型为：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mysql/mysql.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mysql_data_seek</span><span class="params">(MYSQL_RES *result,  </span></span></span><br><span class="line"><span class="function"><span class="params">                    my_ulonglong offset)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>13）mysql_row_tell<br>函数原型为：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mysql/mysql.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">MYSQL_ROW_OFFSET <span class="title">mysql_row_tell</span><span class="params">(MYSQL_RES *res)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>这个函数返回一个偏移值，它表示结果集的当前位置，它不是行号，不能用于mysql_data_seek。但是可以将它用于mysql_row_seek。</p>
<p>14）mysql_row_seek<br>函数原型为：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mysql/mysql.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">MYSQL_ROW_OFFSET <span class="title">mysql_row_seek</span><span class="params">(MYSQL_RES *result,</span></span></span><br><span class="line"><span class="function"><span class="params">                        MYSQL_ROW_OFFSET offset)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>这个函数移动结果集的位置，并且返回当前位置。这在已知的点之间跳转是很有用的。</p>
<p>15）mysql_free_result<br>函数原型为：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mysql/mysql.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mysql_free_result</span><span class="params">(MYSQL_RES *result)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>当完成对一个结果集的操作后，必须调用这个函数来释放内存空间。不要试图在调用此函数后，再次使用结果集。</p>
<p>16）mysql_use_result<br>函数原型为：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mysql/mysql.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">MYSQL_RES *<span class="title">mysql_use_result</span><span class="params">(MYSQL *mysql)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>这个函数也和mysql_store_result一样，返回一个结果集的指针，不过，实际上它并没有检索到任何数据，仅仅初始化来接收数据，为了获得数据必须反复调用mysql_fetch_row，知道检索完数据。出错返回NULL。这中情况下，将不能使用函数mysql_num_rows，mysql_data_seek，mysql_row_seek，mysql_rows_tell，准确的说，mysql_num_rows可以被调用，不过在mysql_fetch检索完之前是不可能获取到可用的行数的。使用这个降低了网络通信量。<br>仅仅检索数据是没有用的，应该能够做进一步工作，返回的数据一般有两种：</p>
<ul>
<li>检索到的实际数据</li>
<li>关于数据的数据，即元数据</li>
</ul>
<p>17）mysql_field_count<br>函数原型为：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mysql/mysql.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">mysql_field_count</span><span class="params">(MYSQL *mysql)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>可以使用mysql_field_count函数返回最近一次执行查询中字段的数目。当mysql_store_result返回NULL的时候，可以调用这个函数来确定mysql_store_result为什么调用失败。一般来说，mysql_store_result失败的原因有：</p>
<ul>
<li>malloc调用失败，例如，结果集太大了。</li>
<li>不能读数据，如连接出现了错误。</li>
<li>查询没有返回数据，如查询语句是INSERT，UPDATE和DELETE。</li>
</ul>
<p>总是可以用这个函数来检查查询是否返回了空结果集。</p>
<p>18）mysql_fetch_field,mysql_fetch_fields<br>函数原型为：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mysql/mysql.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">MYSQL_FIELD *<span class="title">mysql_fetch_field</span><span class="params">(MYSQL_RES *result)</span></span>;</span><br><span class="line"><span class="function">MYSQL_FIELD *<span class="title">mysql_fetch_fields</span><span class="params">(MYSQL_RES *res)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>这个函数返回一个MYSQL_FIELD结构体或数组，是结果集中的列定义。重复调用这个函数返回所有关于列的信息，当没有更多列时，返回NULL。<br>其中MYSQL_FIELD结构体的定义如下：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">st_mysql_field</span> &#123;</span></span><br><span class="line">  <span class="keyword">char</span> *name;                 <span class="comment">/* Name of column */</span></span><br><span class="line">  <span class="keyword">char</span> *org_name;             <span class="comment">/* Original column name, if an alias */</span></span><br><span class="line">  <span class="keyword">char</span> *table;                <span class="comment">/* Table of column if column was a field */</span></span><br><span class="line">  <span class="keyword">char</span> *org_table;            <span class="comment">/* Org table name, if table was an alias */</span></span><br><span class="line">  <span class="keyword">char</span> *db;                   <span class="comment">/* Database for table */</span></span><br><span class="line">  <span class="keyword">char</span> *catalog;          <span class="comment">/* Catalog for table */</span></span><br><span class="line">  <span class="keyword">char</span> *def;                  <span class="comment">/* Default value (set by mysql_list_fields) */</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">long</span> length;       <span class="comment">/* Width of column (create length) */</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">long</span> max_length;   <span class="comment">/* Max width for selected set */</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> name_length;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> org_name_length;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> table_length;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> org_table_length;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> db_length;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> catalog_length;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> def_length;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> flags;         <span class="comment">/* Div flags */</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> decimals;      <span class="comment">/* Number of decimals in field */</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> charsetnr;     <span class="comment">/* Character set */</span></span><br><span class="line">  <span class="keyword">enum</span> enum_field_types type; <span class="comment">/* Type of field. See mysql_com.h for types */</span></span><br><span class="line">  <span class="keyword">void</span> *extension;</span><br><span class="line">&#125; MYSQL_FIELD;</span><br></pre></td></tr></table></figure></p>
<p>19）IS_NUM<br>这是一个宏定义，用来检测字段是否是数字形式的，如果是，返回真。参数为MYSQL_FIELD结构体中的枚举类型type。</p>
<p>20）mysql_field_seek<br>函数原型为：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mysql/mysql.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">MYSQL_FIELD_OFFSET <span class="title">mysql_field_seek</span><span class="params">(MYSQL_RES *result,</span></span></span><br><span class="line"><span class="function"><span class="params">                       MYSQL_FIELD_OFFSET offset)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>这个函数将字段光标移动到给定的偏移量，下一调用mysql_fetch_field将返回该偏移量指定的列。返回当前的偏移量。</p>
<p>21）mysql_field_tell<br>函数原型为；<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mysql/mysql.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">MYSQL_FIELD_OFFSET <span class="title">mysql_field_tell</span><span class="params">(MYSQL_RES *res)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>这个函数用来设置当前连接的字符编码。csname指向一个有效的字符编码名字。函数作用与SET NAMES类似。这个函数会影响mysql_real_escape_string()的行为。<br>执行成功返回0，否则返回非0。一般来说，要显式的指定编码。<br>一个例子：<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">MYSQL mysql;</span><br><span class="line"></span><br><span class="line">mysql_init(<span class="variable">&amp;mysql</span>);</span><br><span class="line">if (!mysql_real_connect(<span class="variable">&amp;mysql</span>,<span class="string">"host"</span>,<span class="string">"user"</span>,<span class="string">"passwd"</span>,<span class="string">"database"</span>,<span class="number">0</span>,NULL,<span class="number">0</span>))</span><br><span class="line">&#123;</span><br><span class="line">    fprintf(stderr, <span class="string">"Failed to connect to database: Error: %s\n"</span>,</span><br><span class="line">          mysql_error(<span class="variable">&amp;mysql</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (!mysql_set_character_set(<span class="variable">&amp;mysql</span>, <span class="string">"utf8"</span>))</span><br><span class="line">&#123;</span><br><span class="line">    printf(<span class="string">"New client character set: %s\n"</span>,</span><br><span class="line">           mysql_character_set_name(<span class="variable">&amp;mysql</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>23）mysql_autocommit<br>函数原型为：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mysql/mysql.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">my_bool <span class="title">mysql_autocommit</span><span class="params">(MYSQL * mysql, my_bool auto_mode)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>mysql的默认提交操作是自动提交（autocommit），除非显式的开始一个事务，否则，每个查询被当做一个单独的事务自动执行，可以通过这个函数来开始一个事务。<br>MySQL默认的存储引擎是MyISAM，MyISAM存储引擎不支持事务处理，所以改变autocommit没有什么作用，InnoDB存储引擎支持事务处理。InnoDB表引擎下关闭mysql自动事物提交可以大大提高数据插入的效率，这是因为如果需要插入1000条数据，mysql会自动发起（提交）1000次的数据写入请求，如果把autocommit关闭掉，通过程序来控制，只要一次commit就可以搞定。<br>auto_mode参数为0或1。执行成功返回0，否则返回非0。</p>
<p>24）mysql_commit<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mysql/mysql.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">my_bool <span class="title">mysql_commit</span><span class="params">(MYSQL * mysql)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>手动进行一次提交操作。执行成功返回0，否则返回非0。</p>
<p>25）mysql_rollback<br>函数原型为：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mysql/mysql.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">my_bool <span class="title">mysql_rollback</span><span class="params">(MYSQL * mysql)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>手动进行一次回滚操作，执行成功返回0，否则返回非0。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>1）<a href="http://www.cnblogs.com/yeahgis/p/3381485.html" target="_blank" rel="noopener">http://www.cnblogs.com/yeahgis/p/3381485.html</a></p>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2021-10-22T06:46:41.732Z" itemprop="dateUpdated">2021-10-22 06:46:41</time>
</span><br>


        
    </div>
    <footer>
        <a href="https://gwq5210.com">
            <img src="/images/logo.jpg" alt="gwq5210">
            gwq5210
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/c语言/">c语言</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/">mysql</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据库/">数据库</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://gwq5210.com/2016/01/23/c语言中使用数据库/&title=《c语言中使用数据库》 — gwq5210's Blog&pic=https://gwq5210.com/images/logo.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://gwq5210.com/2016/01/23/c语言中使用数据库/&title=《c语言中使用数据库》 — gwq5210's Blog&source=安装首先，要安装mysql数据库，安装好后，可能还不能使用mysql的c语言库，还要安装mysql的库，命令如下：sudo apt-get install..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://gwq5210.com/2016/01/23/c语言中使用数据库/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《c语言中使用数据库》 — gwq5210's Blog&url=https://gwq5210.com/2016/01/23/c语言中使用数据库/&via=https://gwq5210.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://gwq5210.com/2016/01/23/c语言中使用数据库/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2016/07/30/google protobuf简介/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">google protobuf简介及使用</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2016/01/22/c语言中的可变参数/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">c语言中的可变参数</h4>
      </a>
    </div>
  
</nav>



    











    <!-- Valine Comments -->
    <div class="comments vcomment" id="comments"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
    <!-- Valine Comments script -->
    <script>
        var GUEST_INFO = ['nick','mail','link'];
        var guest_info = 'nick,mail'.split(',').filter(function(item){
          return GUEST_INFO.indexOf(item) > -1
        });
        new Valine({
            el: '#comments',
            notify: 'true' == 'true',
            verify: 'false' == 'true',
            appId: "IriDzPGksK3yHDWn9k9LXd7n-gzGzoHsz",
            appKey: "cto0PcUNCVqr0zck28XwwDwt",
            avatar: "mm",
            placeholder: "Just go go",
            guest_info: guest_info.length == 0 ? GUEST_INFO : guest_info,
            pageSize: "10"
        })
    </script>
    <!-- Valine Comments end -->




</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/images/wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/images/wechat.jpg" data-alipay="/images/alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>This blog is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>gwq5210 &copy; 2015 - 2021</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://gwq5210.com/2016/01/23/c语言中使用数据库/&title=《c语言中使用数据库》 — gwq5210's Blog&pic=https://gwq5210.com/images/logo.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://gwq5210.com/2016/01/23/c语言中使用数据库/&title=《c语言中使用数据库》 — gwq5210's Blog&source=安装首先，要安装mysql数据库，安装好后，可能还不能使用mysql的c语言库，还要安装mysql的库，命令如下：sudo apt-get install..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://gwq5210.com/2016/01/23/c语言中使用数据库/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《c语言中使用数据库》 — gwq5210's Blog&url=https://gwq5210.com/2016/01/23/c语言中使用数据库/&via=https://gwq5210.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://gwq5210.com/2016/01/23/c语言中使用数据库/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACJ0lEQVR42u3aS26DMBQF0Ox/0+m4ioB7bVIV+zCKGmJ8qPT0Pn694uv9cR19e/6Xz89Hz3p948LAwHgs4316nTParefr5HvDwMDYh3Ee+Np7Dh8Wf5s/FwMDAyMJgmMBdyaJxMDAwLgtXTtYPw/EGBgYGG0Rm6R3OS8vg2+uxTEwMB7IyLvuf//5K/MNDAyMRzHe5dUGyrHhZb0rDAyMpRl5gGtb+WNrzvwWAwNjB0bR2Iq3kpfEbXvuohbHwMBYjnGenOXDyHbNNvgWhS4GBsZCjLY0HWvuJ6OFsbHor1ocAwNjA8ZMkB1L/sbGkxdVOAYGxtKMPMv6bwUtBgbGnoz8uMNMUpi/pov7MTAwlma0G20DYluO5vfUx1gxMDAWYuRlav6rZENJMC3+DxgYGEszxsJc24AbW604bIGBgbEQ4zzwtUnhTCqZJ4j1CREMDIyHM8bStTylGytx6+QPAwNjS8ZdmWZ7OCNJFg/vxMDA2IAxkwLmbbKxJl3U+MPAwNiA0Ya8u1LM/BjHxSvGwMDYgDFWas4D2sHkIQ8DA2MzxlhR2h7LSEJqcdgCAwNjUca7vNqydmwUWh8aw8DAWJoxPx+cGS3c1cjDwMDYgdEG2fyt5Pgik23PjGBgYCzEaFvz80cx8iFBtCYGBgbG0LgxGj3GbbsLMAYGBsZE4Zqs0Abl4gArBgbGQoykiP3ekKAdjmJgYOzG+EYva6YBl78IDAyMDRg/qgMNy34bmF4AAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


lazyScripts.push('//s95.cnzz.com/z_stat.php?id=1260464046&web_id=1260464046')

</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>



<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" async></script>




<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '死鬼去哪里了！';
            clearTimeout(titleTime);
        } else {
            document.title = '(つェ⊂)咦!又好了!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
